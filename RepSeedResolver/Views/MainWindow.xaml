<Window x:Class="RepSeedResolver.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:RepSeedResolver"
        Title="RepSeedResolver" Width="800" Height="640" MinWidth="640" MinHeight="500"
        Background="{StaticResource BgPrimary}" WindowStartupLocation="CenterScreen"
        FontFamily="Segoe UI Variable Text, Segoe UI">

    <WindowChrome.WindowChrome>
        <WindowChrome GlassFrameThickness="0" CaptionHeight="36"
                      ResizeBorderThickness="6"/>
    </WindowChrome.WindowChrome>

    <Border x:Name="RootBorder">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="36"/>
                <RowDefinition/>
            </Grid.RowDefinitions>

            <!-- Title bar -->
            <Grid Grid.Row="0">
                <TextBlock Text="RepSeedResolver" Foreground="{StaticResource FgSecondary}"
                           FontSize="12" VerticalAlignment="Center" Margin="14,0"/>
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right"
                            VerticalAlignment="Stretch">
                    <Button Style="{StaticResource TitleBarBtn}" Click="MinimizeClick">
                        <Path Data="M 0 0 H 10" Stroke="{StaticResource FgSecondary}" StrokeThickness="1"/>
                    </Button>
                    <Button Style="{StaticResource TitleBarBtn}" Click="MaximizeClick">
                        <Path x:Name="MaxRestoreIcon" Data="M 0 0 H 10 V 10 H 0 Z"
                              Stroke="{StaticResource FgSecondary}" StrokeThickness="1"/>
                    </Button>
                    <Button Style="{StaticResource TitleBarCloseBtn}" Click="CloseClick">
                        <Path Data="M 0 0 L 10 10 M 10 0 L 0 10"
                              Stroke="{StaticResource FgSecondary}" StrokeThickness="1"/>
                    </Button>
                </StackPanel>
            </Grid>

            <!-- Content -->
            <Grid Grid.Row="1" Margin="20,4,20,20">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Config card -->
                <Border Grid.Row="0" Background="{StaticResource BgSurface}"
                        CornerRadius="8" Padding="16,14">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="80"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="36"/>
                            <RowDefinition Height="36"/>
                            <RowDefinition Height="36"/>
                            <RowDefinition Height="36"/>
                            <RowDefinition Height="36"/>
                        </Grid.RowDefinitions>

                        <Label Grid.Row="0" Grid.Column="0" Content="Paks Dir"/>
                        <TextBox Grid.Row="0" Grid.Column="1" x:Name="TxtPaksDir"/>
                        <Button Grid.Row="0" Grid.Column="2" Style="{StaticResource BrowseBtn}"
                                Click="BrowsePaksDir" Margin="4,0,0,0"/>

                        <Label Grid.Row="1" Grid.Column="0" Content="Seed JSON"/>
                        <TextBox Grid.Row="1" Grid.Column="1" x:Name="TxtSeedPath"/>
                        <Button Grid.Row="1" Grid.Column="2" Style="{StaticResource BrowseBtn}"
                                Click="BrowseSeedJson" Margin="4,0,0,0"/>

                        <Label Grid.Row="2" Grid.Column="0" Content="Game"/>
                        <ComboBox Grid.Row="2" Grid.Column="1" Grid.ColumnSpan="2"
                                  x:Name="CmbGame" IsEditable="True"
                                  IsTextSearchEnabled="False" StaysOpenOnEdit="True"/>

                        <Label Grid.Row="3" Grid.Column="0" Content="Usmap"/>
                        <TextBox Grid.Row="3" Grid.Column="1" x:Name="TxtUsmapPath"/>
                        <Button Grid.Row="3" Grid.Column="2" Style="{StaticResource BrowseBtn}"
                                Click="BrowseUsmap" Margin="4,0,0,0"/>

                        <Label Grid.Row="4" Grid.Column="0" Content="Output Dir"/>
                        <TextBox Grid.Row="4" Grid.Column="1" x:Name="TxtOutputDir"/>
                        <Button Grid.Row="4" Grid.Column="2" Style="{StaticResource BrowseBtn}"
                                Click="BrowseOutputDir" Margin="4,0,0,0"/>
                    </Grid>
                </Border>

                <!-- Run + progress -->
                <Grid Grid.Row="1" Margin="0,12,0,0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid Grid.Row="0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Button Grid.Column="0" x:Name="BtnRun" Content="Run"
                                Style="{StaticResource RunBtn}" Click="RunClicked"/>
                        <TextBlock Grid.Column="1" x:Name="TxtStatus"
                                   Foreground="{StaticResource FgSecondary}"
                                   VerticalAlignment="Center" Margin="12,0,0,0" FontSize="12"/>
                    </Grid>
                    <ProgressBar Grid.Row="1" x:Name="Progress" Margin="0,6,0,0"
                                 Minimum="0" Maximum="100"/>
                </Grid>

                <!-- Tabs -->
                <TabControl Grid.Row="2" Margin="0,14,0,0">
                    <TabItem Header="Log">
                        <TextBox x:Name="TxtLog" IsReadOnly="True"
                                 VerticalScrollBarVisibility="Auto"
                                 VerticalContentAlignment="Top"
                                 Background="{StaticResource BgPrimary}"
                                 Foreground="{StaticResource FgSecondary}"
                                 BorderThickness="0" FontFamily="Cascadia Mono, Consolas"
                                 FontSize="12" TextWrapping="Wrap" AcceptsReturn="True"
                                 Height="Auto" Padding="4">
                            <TextBox.Template>
                                <ControlTemplate TargetType="TextBox">
                                    <ScrollViewer x:Name="PART_ContentHost"
                                                  Background="{TemplateBinding Background}"
                                                  VerticalScrollBarVisibility="Auto"/>
                                </ControlTemplate>
                            </TextBox.Template>
                        </TextBox>
                    </TabItem>
                    <TabItem Header="Results">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            <Grid Grid.Row="0" Margin="0,4,0,4">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBox Grid.Column="0" x:Name="TxtSearch"
                                         TextChanged="SearchChanged" Tag="Search classes..."/>
                                <ComboBox Grid.Column="1" x:Name="CmbResultFile" Width="160"
                                          Margin="8,0,0,0" SelectionChanged="ResultFileChanged">
                                    <ComboBoxItem Content="rep_layout.json" IsSelected="True"/>
                                    <ComboBoxItem Content="class_net_cache.json"/>
                                </ComboBox>
                            </Grid>
                            <TreeView Grid.Row="1" x:Name="ResultTree"
                                      VirtualizingStackPanel.IsVirtualizing="True"
                                      VirtualizingStackPanel.VirtualizationMode="Recycling"
                                      ScrollViewer.CanContentScroll="True">
                                <TreeView.ItemTemplate>
                                    <HierarchicalDataTemplate DataType="{x:Type local:ResultNode}"
                                                              ItemsSource="{Binding Children}">
                                        <TextBlock Text="{Binding Header}"/>
                                    </HierarchicalDataTemplate>
                                </TreeView.ItemTemplate>
                                <TreeView.ItemContainerStyle>
                                    <Style TargetType="TreeViewItem"
                                           BasedOn="{StaticResource {x:Type TreeViewItem}}">
                                        <Setter Property="Foreground"
                                                Value="{StaticResource FgSecondary}"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsTopLevel}" Value="True">
                                                <Setter Property="Foreground"
                                                        Value="{StaticResource FgPrimary}"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding IsPlaceholder}" Value="True">
                                                <Setter Property="FontStyle" Value="Italic"/>
                                                <Setter Property="IsEnabled" Value="False"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TreeView.ItemContainerStyle>
                            </TreeView>
                        </Grid>
                    </TabItem>
                </TabControl>
            </Grid>
        </Grid>
    </Border>
</Window>
